// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  role          String    // Role enum: SUPER_ADMIN, HR_MANAGER, etc.
  status        String    @default("ACTIVE") // UserStatus enum
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  employeeProfile EmployeeProfile?
  
  // Relations
  createdTasks    Task[]    @relation("CreatedTasks")
  assignedTasks   Task[]    @relation("AssignedTasks")
  taskComments    TaskComment[]
  approvedLeaves  LeaveRequest[] @relation("LeaveApprover")
  
  // Audit/System
  notifications   Notification[]
  
  // Messaging
  sentMessages    Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
}

// --- Payroll ---
model PayrollRecord {
  id          String   @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  month       String   // e.g., "2025-11"
  basicSalary Decimal
  allowances  Decimal
  deductions  Decimal
  netSalary   Decimal
  status      String   // PROCESSED, PAID
  paymentDate DateTime?
  createdAt   DateTime @default(now())
}

// --- Messaging ---
model Message {
  id          String   @id @default(uuid())
  senderId    String
  sender      User     @relation("SentMessages", fields: [senderId], references: [id])
  receiverId  String
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  content     String
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
}

model EmployeeProfile {
  id            String    @id @default(uuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id])
  
  fullName      String
  employeeCode  String    @unique
  departmentId  String?
  department    Department? @relation(fields: [departmentId], references: [id])
  designation   String
  dateOfJoining DateTime
  phone         String?
  address       String?
  
  // Relations
  attendance    AttendanceRecord[]
  leaves        LeaveRequest[]
  
  // Advanced Modules
  branchId      String?
  branch        Branch?   @relation(fields: [branchId], references: [id])
  
  appraisals    EmployeeAppraisal[]
  trainings     EmployeeTraining[]
  assets        AssetAssignment[]
  expenses      ExpenseClaim[]
  shifts        EmployeeShift[]
  documents     Document[]
  payrollRecords PayrollRecord[]
}

model Department {
  id        String    @id @default(uuid())
  name      String
  managerId String?
  employees EmployeeProfile[]
}

model Branch {
  id        String    @id @default(uuid())
  name      String
  location  String
  employees EmployeeProfile[]
}

// --- Attendance ---
model AttendanceRecord {
  id          String    @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  date        DateTime
  checkIn     DateTime?
  checkOut    DateTime?
  totalHours  Decimal?
  status      String    // AttendanceStatus enum
  
  // Geo/Bio
  latitude    Float?
  longitude   Float?
  deviceId    String?
}

// --- Leave Management ---
model LeaveRequest {
  id          String    @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  leaveType   String
  startDate   DateTime
  endDate     DateTime
  reason      String
  status      String    @default("PENDING") // LeaveStatus enum
  
  approvedBy  String?
  approver    User?     @relation("LeaveApprover", fields: [approvedBy], references: [id])
}

// --- Task Tracking ---
model Task {
  id          String    @id @default(uuid())
  title       String
  description String?
  priority    String    // TaskPriority enum
  status      String    @default("TODO") // TaskStatus enum
  dueDate     DateTime?
  
  createdById String
  createdBy   User      @relation("CreatedTasks", fields: [createdById], references: [id])
  
  assignedToId String?
  assignedTo   User?    @relation("AssignedTasks", fields: [assignedToId], references: [id])
  
  createdAt   DateTime @default(now())
  comments    TaskComment[]
}

model TaskComment {
  id        String   @id @default(uuid())
  taskId    String
  task      Task     @relation(fields: [taskId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  comment   String
  createdAt DateTime @default(now())
}

// --- Recruitment ---
model JobPosting {
  id          String   @id @default(uuid())
  title       String
  description String
  department  String
  status      String   // OPEN, CLOSED
  applications JobApplication[]
}

model JobApplication {
  id           String   @id @default(uuid())
  jobId        String
  job          JobPosting @relation(fields: [jobId], references: [id])
  candidateName String
  email        String
  resumeUrl    String?
  status       String   // APPLIED, INTERVIEW, OFFERED, REJECTED
  interviews   Interview[]
}

model Interview {
  id            String   @id @default(uuid())
  applicationId String
  application   JobApplication @relation(fields: [applicationId], references: [id])
  interviewerId String
  scheduledAt   DateTime
  feedback      String?
  rating        Int?
}

// --- Performance ---
model EmployeeAppraisal {
  id          String   @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  cycle       String   // e.g., "2025-Q1"
  selfRating  Int?
  managerRating Int?
  comments    String?
  goals       Goal[]
}

model Goal {
  id          String   @id @default(uuid())
  appraisalId String
  appraisal   EmployeeAppraisal @relation(fields: [appraisalId], references: [id])
  description String
  status      String   // PENDING, ACHIEVED
}

// --- Training ---
model TrainingCourse {
  id          String   @id @default(uuid())
  title       String
  description String
  assignments EmployeeTraining[]
}

model EmployeeTraining {
  id          String   @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  courseId    String
  course      TrainingCourse @relation(fields: [courseId], references: [id])
  status      String   // ASSIGNED, COMPLETED
  certificateUrl String?
}

// --- Assets ---
model Asset {
  id          String   @id @default(uuid())
  name        String
  serialNumber String?
  type        String   // LAPTOP, PHONE
  assignments AssetAssignment[]
}

model AssetAssignment {
  id          String   @id @default(uuid())
  assetId     String
  asset       Asset    @relation(fields: [assetId], references: [id])
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  assignedAt  DateTime
  returnedAt  DateTime?
}

// --- Expenses ---
model ExpenseClaim {
  id          String   @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  amount      Decimal
  description String
  status      String   // PENDING, APPROVED, PAID
  receiptUrl  String?
}

// --- Shift Management ---
model Shift {
  id          String   @id @default(uuid())
  name        String   // Morning, Night
  startTime   String
  endTime     String
  assignments EmployeeShift[]
}

model EmployeeShift {
  id          String   @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  shiftId     String
  shift       Shift    @relation(fields: [shiftId], references: [id])
  startDate   DateTime
  endDate     DateTime?
}

// --- Document Vault ---
model Document {
  id          String   @id @default(uuid())
  employeeId  String
  employee    EmployeeProfile @relation(fields: [employeeId], references: [id])
  title       String
  fileUrl     String
  type        String   // OFFER_LETTER, ID_PROOF
}

// --- Announcements ---
model Announcement {
  id          String   @id @default(uuid())
  title       String
  content     String
  createdAt   DateTime @default(now())
  isPinned    Boolean  @default(false)
}

// --- Visitor Management ---
model VisitorLog {
  id          String   @id @default(uuid())
  visitorName String
  purpose     String
  hostId      String?
  checkIn     DateTime
  checkOut    DateTime?
}

// --- Notifications ---
model Notification {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  title       String
  message     String
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
}
